
# 00-环境配置

## 下载Linux内核源码

[linux kernel](https://www.kernel.org/)

## 配置虚拟机, Ubuntu16.04

VMWare Work statation + Ubuntu16.04 iso

默认完成安装,略

![20230222081849](https://raw.githubusercontent.com/learner-lu/picbed/master/20230222081849.png)

## 配置 Vscode 环境

测试文件如下,打开后可以看到飘红

```c
#include <linux/init.h>
#include <linux/module.h>

MODULE_LICENSE("GPL");
MODULE_AUTHOR("PD");

static int hello_init(void)
{
	printk("hello_init \n");
	return 0;
}
static void hello_exit(void)
{
	printk("hello_exit \n");
	return;
}

module_init(hello_init); //insmod
module_exit(hello_exit);//rmmod
```

首先我们需要将Linux内核头文件所在的目录加入路径,改头文件的位置在 `/usr/src/linux???/include`, 其中中间的文件名部分可以使用如下指令查看获得

```bash
uname -r
# 4.15.0-142-generic
```

笔者电脑是 x86 架构,所以添加 arch/x86/include 路径

如果你使用 Microsoft 的 C++ extension 配置如下

其中`/home/lzx/Driver/linux-3.14-fs4412/include`为linux源码的include的路径,还需要两个宏 `__KERNEL__` `__GNUC__`

```json
{
    "configurations": [
        {
            "name": "Linux",
            "includePath": [
                "${workspaceFolder}/**",
                "/usr/src/linux-headers-4.15.0-142/include",
                "/usr/src/linux-headers-4.15.0-142-generic/include",
                "/usr/src/linux-headers-4.15.0-142-generic/arch/x86/include",
                "/usr/src/linux-headers-4.15.0-142/include/uapi",
                "/usr/src/linux-headers-4.15.0-142-generic/arch/x86/include/generated"
            ],
            "defines": [
                "__KERNEL__",
                "__GNUC__"
            ],
            "compilerPath": "/usr/bin/gcc",
            "cStandard": "gnu11",
            "cppStandard": "gnu++14",
            "intelliSenseMode": "${default}",
            "compilerArgs": []
        }
    ],
    "version": 4
}
```

注意,无法在vmworkstation使用`sudo su`进入root用户,解决办法是重新设置一下密码,然后就可以进入了

```bash
sudo passwd
# 你的新密码,可以和原密码相同
su
```